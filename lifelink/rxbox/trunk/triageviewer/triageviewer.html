<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>ECG</title>
    <link href="layout.css" rel="stylesheet" type="text/css"></link>
    <!--[if IE]><script language="javascript" type="text/javascript" src="../excanvas.pack.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="flot/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="flot/jquery.flot.js"></script>

    <script language="javascript" type="text/javascript">
	 $(document).ready(function() {
	 	arr = previous = ecg = new Array();

		var fetchtimer = setInterval(function() {
               	    $.get("getdata.php", { session: "sessionxyz", time: "2pm" },
                        function(data){
				ecg = data[0];
	                }, "json");
			
                    var i = 0;
                    arr = [];
                    var plottimer = setInterval(function(){
                        var nullarr = [null, null, null, null, null, null];
                        arr = arr.concat(ecg.slice(i,i+19));

                        plot.setData([ { data: arr.concat(nullarr, previous.slice(i+20, previous.length)) } ]);
                        plot.draw();

                        i+=20;
                        if(i >= ecg.length) {
                                previous = arr.slice();
                                clearInterval(plottimer);
                        }
                    },1);


		}, 10000);
	 });
    </script>
 </head>
    <body>
    <center><h1>Electrocardiograph</h1>

    <div id="placeholder" style="width:1024px;height:400px;"></div></center>


<script id="source" language="javascript" type="text/javascript">
$(function () {
    var alldata = [ { data: ecg } ];
    var options = {
    		lines: { show: true, fill: true, fillColor: "rgba(255, 255, 255, 0.8)", lineWidth: 1 },
    		points: { show: false },
		shadowSize: 0,
  		grid: {
			borderWidth: 1,
    			color: "rgba(255,0,0, 0.5)",
			tickColor: "rgba(255,0,0, 0.5)",
  		},
  		xaxis: {
			min: 0,
			max: 10,
			tickSize: 0.2,
    			minTickSize: 0.2
  		},
                yaxis: {
                        min: -2,
                        max: 2,
                        tickSize: 0.2,
                        minTickSize: 0.2
                },
		colors:  [ "#000000"] 

  	};

    plot = $.plot($("#placeholder"), alldata, options);
});
</script>

 </body>
</html>
